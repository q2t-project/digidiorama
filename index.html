<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>digidiorama viewer/</title>
  <style>
    :root { --bg: #0b1020; --fg: #e6edf3; --accent: #5aa9ff; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:14px/1.4 system-ui}
    #app{position:fixed;inset:0;display:grid;grid-template-rows:auto 1fr}
    header{display:flex;gap:.5rem;align-items:center;padding:.5rem .75rem;background:#0e142a;border-bottom:1px solid #1d2748}
    header h1{font-size:14px;font-weight:600;margin:0;letter-spacing:.3px}
    header .spacer{flex:1}
    header select, header button{
      appearance:none;border:1px solid #2a3969;background:#131a33;color:var(--fg);
      padding:.5rem 1rem;border-radius:.4rem;cursor:pointer;min-height:44px
    }
    header button:hover, header select:hover{border-color:#39529c;background:#1a2347}
    #main{display:grid;grid-template-columns:1fr 250px;overflow:hidden}
    #viewer{position:relative;overflow:hidden}
    #panel{background:#10172c;border-left:1px solid #1d2748;padding:.5rem;overflow-y:auto;transition:transform .3s ease}
    #panel h2{font-size:13px;margin:.5rem 0}
    #panel .meta-item, #panel .error-item, #panel .node-item{font-size:12px;margin-bottom:.25rem}
    .credit{position:absolute;right:.5rem;bottom:.5rem;font-size:11px;opacity:.7}
    canvas{display:block;width:100%;height:100%;}
    #tabs { display:none; margin-bottom:.5rem; }
    #tabs button { flex:1; padding:.5rem; border:none; background:#2a3969; color:#fff; border-radius:.3rem; cursor:pointer; }
    #tabs button.active { background:var(--accent); }
    .tab-pane { display:block; }
    @media(max-width:600px){
      #main{grid-template-columns:1fr;}
      #panel{position:absolute;z-index:10;width:100%;height:40%;bottom:0;left:0;border-left:none;border-top:1px solid #1d2748;transform:translateY(100%)}
      #panel.open{transform:translateY(0)}
      #fab{position:absolute;right:.75rem;bottom:.75rem;width:56px;height:56px;border-radius:50%;background:var(--accent);color:#fff;border:none;font-size:24px;cursor:pointer;z-index:20}
      #tabs { display:flex; gap:.5rem; }
      #tab-content .tab-pane { display:none; }
      #tab-content .tab-pane.active { display:block; }
    }
    @media(min-width:601px){
      #panel{width:250px;right:0;top:0;height:100%;transform:translateX(0)}
      #panel.closed{transform:translateX(100%)}
      #fab{position:absolute;right:.75rem;bottom:.75rem;width:56px;height:56px;border-radius:50%;background:var(--accent);color:#fff;border:none;font-size:24px;cursor:pointer;z-index:20}
      #tabs { display:none; }
      #tab-content .tab-pane { display:block; }
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1 data-i18n="title">デジジオラマ</h1>
      <div class="spacer"></div>
      <select id="fileSelect"></select>
      <select id="langSelect">
        <option value="ja">日本語</option>
        <option value="en">English</option>
      </select>
      <button id="btnReset" data-i18n="reset">Reset</button>
      <div id="layersMenu" style="position:relative;">
        <button id="btnLayers" data-i18n="layers">Layers ▼</button>
        <div id="layersDropdown" style="display:none;position:absolute;right:0;top:100%;background:#131a33;border:1px solid #2a3969;padding:.5rem;border-radius:.4rem;">
          <label><input type="checkbox" id="toggle-nodes" checked /> Nodes</label><br/>
          <label><input type="checkbox" id="toggle-edges" checked /> Edges</label><br/>
          <label><input type="checkbox" id="toggle-labels" checked /> Labels</label><br/>
          <label><input type="checkbox" id="toggle-aux" checked /> Auxiliary</label>
        </div>
      </div>
    </header>
    <div id="main">
      <div id="viewer"></div>
      <div id="panel" class="closed">
        <div id="tabs">
          <button data-tab="node" class="active">Node</button>
          <button data-tab="errors">Errors</button>
          <button data-tab="meta">Meta</button>
        </div>
        <div id="tab-content">
          <div id="node" class="tab-pane active"></div>
          <div id="errors" class="tab-pane"></div>
          <div id="meta" class="tab-pane">
            <div id="counts"></div>
          </div>
        </div>
      </div>
    </div>
    <button id="fab">≡</button>
  </div>
  <div class="credit">MIT © q2t-project / Content © respective authors</div>

  <!-- JS部分省略（最新のThree.js制御・fitCameraToScene・ラベル3平面対応・レイヤー永続性・showMeta修正済み） -->
</body>
</html>